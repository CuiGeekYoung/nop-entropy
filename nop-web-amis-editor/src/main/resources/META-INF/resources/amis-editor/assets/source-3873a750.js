import{j as R,r as h,T as N,F as q,a as I,b as L,t as v,c as j,d as E,e as T}from"./vendor-cef92a15.js";const f=R.jsx,O=R.jsxs;const A="modulepreload",B=function(e,t){return new URL(e,t).href},x={},W=function(t,o,i){if(!o||o.length===0)return t();const r=document.getElementsByTagName("link");return Promise.all(o.map(s=>{if(s=B(s,i),s in x)return;x[s]=!0;const u=s.endsWith(".css"),y=u?'[rel="stylesheet"]':"";if(!!i)for(let c=r.length-1;c>=0;c--){const d=r[c];if(d.href===s&&(!u||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${y}`))return;const l=document.createElement("link");if(l.rel=u?"stylesheet":A,u||(l.as="script",l.crossOrigin=""),l.href=s,document.head.appendChild(l),u)return new Promise((c,d)=>{l.addEventListener("load",c),l.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t())};function _(e){return Object.prototype.toString.call(e)==="[object String]"}function F(e,t,o=!1){h.useEffect(()=>(window.addEventListener(e,t,o),function(){window.removeEventListener(e,t)}))}const g={};let M=1,C="cxd",k="zh-CN";const $={fetcher(e){return new Promise(t=>{const o=M++,i=setTimeout(()=>{r({status:500,data:{ok:!1,status:500,msg:"调用超时"}})},5e3);function r(s){window.clearTimeout(i),delete g[o],t(s)}g[o]={onComplete:r,timerId:i},p({type:"ajaxFetch",reqId:o,data:{method:e.method,url:e.url,data:e.data,query:e.query,headers:e.headers}})})},notify:(e,t,o)=>{t.startsWith("_")||(o={closeButton:!0,...o}(v)[e]?v[e](t,o):console.warn("[notify]",e,t),console.log("[notify]",e,t))},confirm:j,alert:E};let w=!1,m;function p(e){var o;const t=_(e)?e:JSON.stringify(e);(o=window.parent)==null||o.postMessage(t,"*")}function J(){const[e,t]=h.useState(!1),[o,i]=h.useState(!1),r=window.AMIS_JSON||{type:"page",body:"测试",title:"标题"},[s,u]=h.useState(r);m||(m=s),F("message",a=>{let n=a.data;if(n){if(_(n)&&n.startsWith("{")&&(n=JSON.parse(n)),n.type==="setSchema")w=!0,m=n.data,u(n.data);else if(n.type==="alert")E(n.message);else if(n.type==="toast")(n.level||"info")==="info"?v.info(n.message):v.error(n.message);else if(n.type==="ajaxComplete"){const b=g[n.reqId];b&&b.onComplete(n.result)}}}),w||(w=!0,p("amis-editor-inited"));const y=a=>{m=a},S=()=>{p("amis-editor-rollback")},l=()=>{p("amis-editor-reload")},c=()=>{console.log("Save",m),p({type:"save",data:m})},d=()=>{j("确认退出吗?").then(a=>{a&&p("amis-editor-exit")})};return O("div",{className:"nop-amis-editor",children:[f(N,{theme:C,position:"top-right",locale:k},"toast"),f(q,{theme:C,locale:k},"alert"),f("div",{className:"nop-amis-editor-header",children:f("div",{children:I({type:"form",mode:"inline",title:"",wrapWithPanel:!1,body:[{type:"switch",option:"预览",name:"preview",onChange:function(a){i(a)}},{type:"switch",option:"移动端",name:"mobile",onChange:function(a){t(a)}},{type:"button",label:"回滚",tooltip:"放弃所有修改，重置为系统初始化版本",level:"primary",onClick:function(){S()}},{type:"button",label:"重新载入",tooltip:"重新从后台服务器载入页面",level:"primary",onClick:function(){l()}},{type:"button",label:"保存",tooltip:"保存到后台服务器",level:"primary",onClick:function(){c()}},{type:"button",label:"退出",tooltip:"退出编辑器",level:"danger",onClick:function(){d()}}]})})}),f(L,{className:"nop-amis-editor-body",preview:o,isMobile:e,onChange:y,value:s,theme:"cxd",onSave:c,amisEnv:$})]})}const U=e=>{e&&e instanceof Function&&W(()=>import("./vendor-cef92a15.js").then(t=>t.w),["./vendor-cef92a15.js","./vendor-6c5945f7.css"],import.meta.url).then(({getCLS:t,getFID:o,getFCP:i,getLCP:r,getTTFB:s})=>{t(e),o(e),i(e),r(e),s(e)})},V=T.createRoot(document.getElementById("root"));V.render(f(J,{}));U();export{W as _};
