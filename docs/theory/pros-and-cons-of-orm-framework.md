# 如何评价一种框架技术（比如ORM框架）的好坏？

一个很有趣的问题是，一个新的框架技术出现的时候，我们如何评价它的好坏？NopORM引擎今年开源以来，也收到了一些反馈，不过大部分人应该没有看懂NopORM引擎的理论部分，所以普遍的疑惑是NopORM相对于其他ORM引擎到底有什么具体的优势？ 在本文中我想谈一谈评价一个框架可以有哪些不以人的经验、喜好、熟悉程度为转移的客观标准。

> 有趣的是，有些人虽然自己从来不看理论部分，但是谈到国内外软件技术的差距来，论调却是“国内开发都强调实用主义，在软件方法论方面的差距太大了”。这只能说是一种叶公好龙的迷惑行为了。

> 关于NopORM引擎的理论分析，可以参见 [低代码平台需要什么样的ORM引擎？(1)](https://zhuanlan.zhihu.com/p/543252423)和[低代码平台需要什么样的ORM引擎?(2)](https://zhuanlan.zhihu.com/p/545063021)


# 朴素的评判标准

很多人对于框架技术的评判标准是很朴素的，比如：

1. **使用XML这种被淘汰的技术作为信息载体，差评！**
根据某种局部的技术表现形式来判断一种框架技术的优劣无疑是片面化、表面化的，一种创新性技术的本质是提供了一种新的逻辑组织机制，这种机制具体以什么样的技术形式作为表观载体是一个次要性的问题。

2. **用的人多吗？文档详细吗？**
这是最实用主义的一种观点。但它评价的是对我这种拿来主义的人而言，这个框架是否容易使用的问题，而不是这个框架本身的设计优劣问题。

3. **用着方便，容易理解**
这里表达的其实是一种主观感受，而不是可以客观衡量的判据。在不同的技术环境、技术背景下，每个人有着不同的技术偏好，个体感受可能存在着巨大差异。

# 存在客观的评判标准吗？

软件开发虽然是一种实践性很强的技术活动，但是在科学昌明的今天，它显然也不应该是一种完全依赖于经验积累的玄学。我们可以从计算机科学的基本原理--信息论的角度出发给出一些客观的评判标准。

## 一. 业务代码开发是否独立于框架特有的接口和对象？

近二十年以来，软件框架技术领域的一个最重要的进展就是认识到框架的中立性（framework agnostic）。业务代码开发本质上是对业务信息的一种表达，这种表达原则上应该独立于任何软件框架，甚至是独立于任何技术因素。**框架的作用是辅助我们用最自然、最直观的方式来表达业务信息，同时能够满足性能和其他技术规范要求**。**最理想的框架，应该是在开发业务代码时完全意识不到它存在的框架**。

这样做的好处在于我们可以**避免业务域和纯技术域之间的信息渗透和污染**，使得业务代码的测试、技术框架的升级甚至更换变得异常简单。

### POJO和轻量级框架

轻量级框架的星星之火是从反对EJB这种重型容器技术开始燃起的。传统的框架往往关注重点是提供功能特性，在使用框架的过程中不可避免的在业务代码中会引用框架特有的对象、插入框架特有的函数调用等，这使得业务功能的实现与具体运行环境强绑定，甚至和框架的某个版本强绑定。而轻量级框架首次推广了POJO的概念，在编写一般性的业务代码时，业务代码所操纵的对象在形式上就是没有任何框架依赖的普通Java对象。比如Spring1.0的配置中，Bean的实现完全不需要具有Spring框架的知识，在beans.xml配置文件中即可实现任意复杂的bean的装配。

在这一观点下，传统的SpringMVC框架的如下设计是不合适的，

```javascript
  public void myMethod(HttpServletRequest request){
  	...
  }

  @RequestMapping("/test")
  public ModelAndView test(){
     ModelAndView mav=new ModelAndView("hello");
     mav.addObject("time", new Date());
     mav.getModel().put("name", "caoyc");
     
     return mav;
  }
```

在新的Web框架设计中，一般都是接收POJO对象，返回POJO对象，除了函数上的注解之外没有任何框架依赖的痕迹，而注解本身又只是一些纯粹的描述性信息

```javascript

    @POST
    @Path("/my-method2")
    ApiResponse<MyResponseBean> myMethod2(MyRequestBean requestBean){
    	...
    }

```

在Nop平台中NopGraphQL框架直接将请求参数规范化为一个JSON对象，而不需要像传统Web框架那样引入传参的N种方式（通过param传，通过restPath传，通过cookie传等）。这使得业务代码脱离了对Web运行环境的依赖，同样的服务函数可以直接注册为Kafka消息队列的响应函数，或者批处理文件的处理函数，进行自动化测试的时候也不需要Mock Web服务器，测试成本大为降低。例如，只要我们提供了在线的针对单个账户的入账服务，则无需编程，通过简单配置就可以得到一个每晚定时运行的读取批处理文件执行的批量入账服务。

> 前端Redux和Vuex框架本质上也都是将action规范化为针对单个POJO对象的单参数函数。

在Dao访问层，现在大量的ORM框架都可以识别JPA注解，这使得同一个实体定义可以应用于多种ORM框架。

### 虚拟DOM和Hooks

在前端领域越来越多的业务逻辑也开始采用框架中立的表达形式。

例如，虚拟DOM概念的引入使得前端框架可以脱离浏览器运行环境，这造就了React Native这种多端统一的开发技术和各类小程序框架的繁荣。虚拟DOM本质上就是普通的JavaScript对象，不同的运行时都可以创建并且翻译同样的虚拟DOM。

Hooks概念的发展使得前端界面逻辑的表达可以摆脱组件对象的形式束缚，只需要引入最小化的Hooks假定，就可以将业务逻辑抽象到框架无关的纯逻辑函数中。借助于Hooks这样的抽象，Headless的组件库逐渐开始占据主流，并且可以用同一套核心代码适配React/Vue/Angular等多种基础框架。

## 二. 框架进行了哪些自动推导？

一个框架如果具有本质上的优越性，那么它一定是**相比于其他可选方案更充分的利用了某些信息，并且基于这些信息自动推导完成了大量的工作**。


### 注解 vs. XML配置



