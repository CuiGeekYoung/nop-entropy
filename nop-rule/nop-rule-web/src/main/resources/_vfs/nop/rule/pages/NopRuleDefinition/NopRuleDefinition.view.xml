<?xml version="1.0" encoding="UTF-8" ?>
<view x:extends="_gen/_NopRuleDefinition.view.xml" x:schema="/nop/schema/xui/xview.xdef"
      xmlns:x="/nop/schema/xdsl.xdef">

    <grids>
        <grid id="list"/>
        <grid id="pick-list"/>
    </grids>

    <forms>
        <form id="template" x:abstract="true">
            <cells>
                <cell id="ruleInputs">
                    <selection>
                        name,displayName,type, computed, mandatory, defaultExpr, schema
                    </selection>
                </cell>

                <cell id="ruleOutputs">
                    <selection>
                        name,displayName,type, aggregate, schema
                    </selection>
                </cell>
            </cells>
        </form>

        <form id="edit" layoutControl="tabs" size="xl" x:prototype="template">
            <layout>
                ==baseInfo[基本信息]====
                ruleName[规则名称] ruleVersion[规则版本]
                displayName[显示名称] ruleGroup[规则分组]
                ruleType[规则类型] status[状态]
                description[描述]
                remark[备注]

                ==authConfig[权限配置]===
                !ruleRoles

                ==inputsConfig[输入]===
                !ruleInputs

                ==outputsConfig[输出]===
                !ruleOutputs

                ==extConfig[扩展配置]==
                beforeExecute
            </layout>

            <cells>
                <cell id="ruleInputs">
                    <gen-control>
                        return { "$ref": "inputDefinition" }
                    </gen-control>
                </cell>

                <cell id="ruleOutputs">
                    <gen-control>
                        return { "$ref":"outputDefinition" }
                    </gen-control>
                </cell>
            </cells>
        </form>


        <form id="view" x:prototype="edit">
            <!-- 继承的_NopRuleDefinition模型中已经定义了layout，这里希望使用edit所对应的layout，所以要删除继承的部分。
                x:prototype在x:extends执行完毕之后执行。
             -->
            <layout x:override="remove"/>

            <cells>
                <cell id="ruleInputs">
                    <gen-control>
                        return { "$ref": "viewInputDefinition" }
                    </gen-control>
                </cell>

                <cell id="ruleOutputs">
                    <gen-control>
                        return { "$ref": "viewOutputDefinition" }
                    </gen-control>
                </cell>
            </cells>
        </form>

        <form id="query">
            <layout>
                ruleName displayName ruleGroup
            </layout>
        </form>
    </forms>

    <pages>
        <crud name="main">
            <rowActions>
                <actionGroup id="row-more-button">
                    <action id="row-edit-rule-nodes" label="@i18n:rule.ruleNodes|规则节点" actionType="drawer">
                        <dialog page="/nop/rule/pages/NopRuleNode/ref-ruleDefinition.page.yaml" size="xl">
                            <data>
                                <ruleId>$ruleId</ruleId>
                                <ruleDefinition>
                                    <displayName>$displayName</displayName>
                                </ruleDefinition>
                            </data>
                        </dialog>
                    </action>
                    <action id="row-update-button"/>
                </actionGroup>
            </rowActions>
        </crud>
        <picker name="picker"/>
    </pages>
</view>