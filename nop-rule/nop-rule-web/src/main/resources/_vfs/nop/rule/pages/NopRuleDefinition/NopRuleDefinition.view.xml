<?xml version="1.0" encoding="UTF-8" ?>
<view x:extends="_gen/_NopRuleDefinition.view.xml" x:schema="/nop/schema/xui/xview.xdef"
      xmlns:x="/nop/schema/xdsl.xdef">

    <grids>
        <grid id="list"/>
        <grid id="pick-list"/>
    </grids>

    <forms>
        <form id="template" x:abstract="true">
            <cells>
                <cell id="ruleInputs">
                    <selection>
                        name,displayName,type, computed, mandatory, defaultExpr, schema
                    </selection>
                </cell>

                <cell id="ruleOutputs">
                    <selection>
                        name,displayName,type, aggregate, schema
                    </selection>
                </cell>
            </cells>
        </form>

        <form id="edit" layoutControl="tabs" size="xl" x:prototype="template">
            <layout>
                ==baseInfo[基本信息]====
                __useImportFile importFile
                ruleName[规则名称] ruleVersion[规则版本]
                displayName[显示名称] ruleGroup[规则分组]
                ruleType[规则类型] status[状态]
                description[描述]
                remark[备注]

                ==authConfig[权限配置]===
                !ruleRoles

                ==inputsConfig[输入]===
                !ruleInputs

                ==outputsConfig[输出]===
                !ruleOutputs

                ==extConfig[扩展配置]==
                beforeExecute

                ==matrixConfig[决策矩阵配置]==
                decisionMatrix
            </layout>

            <cells>
                <!-- custom=true表示此字段不需要在meta中定义
                  两个下划线作为前缀表示此字段仅在前端使用，不会提交到后台
                -->
                <cell id="__useImportFile" custom="true" stdDomain="boolean">
                </cell>

                <cell id="importFile" stdDomain="file">
                    <visibleOn>${__useImportFile}</visibleOn>
                </cell>

                <cell id="ruleInputs">
                    <visibleOn>${!__useImportFile}</visibleOn>
                    <gen-control>
                        return { "$ref": "inputDefinition" }
                    </gen-control>
                </cell>

                <cell id="ruleOutputs">
                    <visibleOn>${!__useImportFile}</visibleOn>
                    <gen-control>
                        return { "$ref":"outputDefinition" }
                    </gen-control>
                </cell>

                <cell id="decisionMatrix">
                    <visibleOn>${ruleType == 'MATRX}</visibleOn>
                </cell>
            </cells>
        </form>


        <form id="view" x:prototype="template">
            <layout>
                ==baseInfo[基本信息]====
                ruleName[规则名称] ruleVersion[规则版本]
                displayName[显示名称] ruleGroup[规则分组]
                ruleType[规则类型] status[状态]
                description[描述]
                remark[备注]

                ==authConfig[权限配置]===
                !ruleRoles

                ==inputsConfig[输入]===
                !ruleInputs

                ==outputsConfig[输出]===
                !ruleOutputs

                ==extConfig[扩展配置]==
                beforeExecute

                ==matrixConfig[决策矩阵配置]==
                decisionMatrix
            </layout>

            <cells>
                <cell id="ruleInputs">
                    <gen-control>
                        return { "$ref": "viewInputDefinition" }
                    </gen-control>
                </cell>

                <cell id="ruleOutputs">
                    <gen-control>
                        return { "$ref": "viewOutputDefinition" }
                    </gen-control>
                </cell>

                <cell id="decisionMatrix">
                    <visibleOn>${ruleType == 'MATX'}</visibleOn>
                </cell>
            </cells>
        </form>

        <form id="query">
            <layout>
                ruleName displayName ruleGroup
            </layout>
        </form>
    </forms>

    <pages>
        <crud name="main">
            <rowActions>
                <actionGroup id="row-more-button">
                    <action id="row-edit-rule-nodes" label="@i18n:rule.ruleNodes|规则节点" actionType="drawer">
                        <dialog page="/nop/rule/pages/NopRuleNode/ref-ruleDefinition.page.yaml" size="xl">
                            <data>
                                <ruleId>$ruleId</ruleId>
                                <ruleDefinition>
                                    <displayName>$displayName</displayName>
                                </ruleDefinition>
                            </data>
                        </dialog>
                    </action>
                    <action id="row-update-button"/>
                </actionGroup>
            </rowActions>
        </crud>
        <picker name="picker"/>
    </pages>
</view>